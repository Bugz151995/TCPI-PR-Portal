@using TCPI_PR_Portal.Shared;
@inject HttpClient HttpClient;

<MudGrid Spacing="2" Justify="Justify.Center">
    <MudItem xs="6">
        <MudPaper Elevation="0" Class="d-flex flex-column mud-width-full py-8 px-1 gap-2">
            <MudAutocomplete T="string" Label="Project ID" @bind-Value="PRHeader.U_ProjectID" SearchFunc="@Search" Margin="Margin.Dense" Dense="false" Variant="Variant.Outlined" />
            <MudTextField @bind-Value="PRHeader.U_ProjName" Label="Project Name" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true" />
            <MudTextField @bind-Value="PRHeader.U_Location" Label="Location" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudSelect Margin="Margin.Dense" T="string" Label="PR Type" Variant="Variant.Outlined">
                @*for loop here if there is a supplier array data*@
                <MudSelectItem Value="@("Regular")" />
                <MudSelectItem Value="@("Special - IT")" />
                <MudSelectItem Value="@("Special = Safety")" />
            </MudSelect>
            <MudSelect Margin="Margin.Dense" @bind-Value="SelectedBranch" Label="Branch" Variant="Variant.Outlined">
                @foreach (var b in Branches)
                {
                    <MudSelectItem Value="@b">@b.Name</MudSelectItem>
                }
            </MudSelect>
            <MudSelect Margin="Margin.Dense" @bind-Value="SelectedDepartment" Label="Department" Variant="Variant.Outlined">
                @foreach (var d in Departments)
                {
                    <MudSelectItem Value="@d">@d.Name</MudSelectItem>
                }
            </MudSelect>
        </MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudPaper Elevation="0" Class="d-flex flex-column mud-width-full py-8 px-4 gap-2">
            <MudTextField @bind-Value="PRHeader.U_DocNum" Label="Doc. No" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudTextField @bind-Value="PRHeader.U_DocStatus" Disabled="true" Label="Status" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudDatePicker Label="Document Date" @bind-Date="PRHeader.U_TaxDate" />
            <MudDatePicker Label="Required Date" @bind-Date="PRHeader.U_ReqDate" />
            <MudSelect Margin="Margin.Dense" T="string" Label="Urgency Priority" Variant="Variant.Outlined">
                @*for loop here if there is a supplier array data*@
                <MudSelectItem Value="@("Low")" />
                <MudSelectItem Value="@("Medium")" />
                <MudSelectItem Value="@("High")" />
            </MudSelect>
            <MudTextField @bind-Value="PRHeader.U_PreparedBy" Label="Prepared By" Variant="Variant.Outlined" Margin="Margin.Dense" />
            <MudTextField @bind-Value="PRHeader.U_ReviewedBy" Label="Reviewed By" Variant="Variant.Outlined" Margin="Margin.Dense" />

            
            @*<MudTextField @bind-Value="PRHeader.U_ApprovedBy1" Label="Approved By( Level 1)" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true"/>
            <MudTextField @bind-Value="PRHeader.U_ApprovedBy2" Label="Approved By( Level 2)" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true"/>
            <MudTextField @bind-Value="PRHeader.U_ApprovedBy3" Label="Approved By( Level 3)" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true"/>
            <MudTextField @bind-Value="PRHeader.U_ApprovedBy4" Label="Approved By( Level 4)" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true"/>
            <MudTextField @bind-Value="PRHeader.U_ApproverRemarks " Label="Approver Remarks" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="true"/>*@
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    [Parameter]
    public PRHeaderDto PRHeader { get; set; }

    ProjectsDto SelectedProject;
    DepartmentsDto SelectedDepartment;
    BranchesDto SelectedBranch;

    ProjectsResponse? ProjectResponse = new ProjectsResponse();
    DepartmentsResponse? DepartmentResponse = new DepartmentsResponse();
    BranchesResponse? BranchResponse = new BranchesResponse();
    private IEnumerable<ProjectsDto>? Projects = new List<ProjectsDto>();
    private List<DepartmentsDto>? Departments = new List<DepartmentsDto>();
    private List<BranchesDto>? Branches = new List<BranchesDto>();

    private async Task<IEnumerable<ProjectsDto>> Search(string value)
    {
        // In real life use an asynchronous function for fetching data from an api.
        await Task.Delay(5);

        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
            return Projects;
        return Projects.Where(x => x.Name.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

    // get method json ang makukua,
    protected override async Task OnInitializedAsync()
    {
        var projectsResponse = await HttpClient.GetAsync("Projects?$select=Code,Name");
        ProjectResponse = await projectsResponse.Content.ReadFromJsonAsync<ProjectsResponse>();
        Projects = ProjectResponse.value;

        var departmentsResponse = await HttpClient.GetAsync("Departments?$select=Code,Name");
        DepartmentResponse = await departmentsResponse.Content.ReadFromJsonAsync<DepartmentsResponse>();
        Departments = DepartmentResponse.value;

        var branchesResponse = await HttpClient.GetAsync("Branches?$select=Code,Name");
        BranchResponse = await branchesResponse.Content.ReadFromJsonAsync<BranchesResponse>();
        Branches = BranchResponse.value;
    }

}