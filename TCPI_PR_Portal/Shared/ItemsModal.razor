@using System.Net.Http.Json;
@inject HttpClient HttpClient;
@inject ISnackbar Snackbar;

<MudDialog>
    <DialogContent>
        <MudTable Items="@ItemList" Dense="true" Hover="true" Bordered="false" Striped="true" Filter="new Func<PRLinesDto,bool>(FilterFunc1)" @bind-SelectedItem="selectedItem">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Periodic Elements</MudText>
                <MudSpacer />
                <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Item Code</MudTh>
                <MudTh>Item Description</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Item Code">@context.U_ItemCode</MudTd>
                <MudTd DataLabel="Item Description">@context.U_Dscription</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter] public List<PRLinesDto> ItemList { get; set; }

    void Submit() => MudDialog.Close(DialogResult.Ok(true));
    void Cancel() => MudDialog.Cancel();

    private string searchString = "";
    private PRLinesDto selectedItem = null;

    protected override async Task OnInitializedAsync()
    {
        ItemList = await HttpClient.GetFromJsonAsync<List<PRLinesDto>>("");
    }

    private bool FilterFunc1(PRLinesDto element) => FilterFunc(element, searchString);

    private bool FilterFunc(PRLinesDto element, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (element.U_ItemCode.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (element.U_Dscription.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        return false;
    }

    private async Task<string> GetData(string query)
    {
        using var response = await HttpClient.GetAsync(query);
        if (!response.IsSuccessStatusCode)
        {
            Snackbar.Add("Oops! Something went wrong. This might be a server fault. Try to log-out and log-in.", Severity.Error);
        }

        string content = await response.Content.ReadAsStringAsync();
        return content;
    }
}